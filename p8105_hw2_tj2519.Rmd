---
title: "p8105_hw2_tj2519"
output: github_document
date: "2023-09-30"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(collapse = TRUE, message = FALSE)
```

```{r}
library(tidyverse)
library(readxl)
```


# Problem 1 - process the pols-month, snp, unemployment dataset
## processing the datasets
```{r}
pols_df = 
  read_csv("data/pols-month.csv") %>% 
  janitor::clean_names() %>% 
  separate(mon, c("year", "month", "day"), "-", convert = TRUE) %>% 
  mutate(month = ifelse(month == 1, "jan", month),
         month = ifelse(month == 2, "feb", month),
         month = ifelse(month == 3, "mar", month),
         month = ifelse(month == 4, "apr", month),
         month = ifelse(month == 5, "may", month),
         month = ifelse(month == 6, "jun", month),
         month = ifelse(month == 7, "jul", month),
         month = ifelse(month == 8, "aug", month),
         month = ifelse(month == 9, "sep", month),
         month = ifelse(month == 10, "oct", month),
         month = ifelse(month == 11, "nov", month),
         month = ifelse(month == 12, "dec", month)
         ) %>% 
  mutate(president = ifelse(prez_gop == 1, "gop", "dem")) %>% 
  select(-day, -starts_with("prez"))

print(sapply(pols_df, class))
view(pols_df)


snp_df = 
  read_csv("data/snp.csv") %>% 
  janitor::clean_names() %>% 
  mutate(date = as.Date(date, format = "%m/%d/%y")) %>% 
  separate(date, c("year", "month", "day"), "-") %>% 
  mutate(year = as.numeric(year), month = as.numeric(month)) %>% 
  mutate(year = ifelse(year > as.integer(format(Sys.Date(), "%Y")), 
                       year - 100, year)) %>% 
  arrange(year, month) %>% 
  mutate(month = ifelse(month == 1, "jan", month),
         month = ifelse(month == 2, "feb", month),
         month = ifelse(month == 3, "mar", month),
         month = ifelse(month == 4, "apr", month),
         month = ifelse(month == 5, "may", month),
         month = ifelse(month == 6, "jun", month),
         month = ifelse(month == 7, "jul", month),
         month = ifelse(month == 8, "aug", month),
         month = ifelse(month == 9, "sep", month),
         month = ifelse(month == 10, "oct", month),
         month = ifelse(month == 11, "nov", month),
         month = ifelse(month == 12, "dec", month)
         ) %>%
  select(-day)
  
print(sapply(snp_df, class))
view(snp_df)


unemployment_df = 
  read_csv("data/unemployment.csv") %>% 
  janitor::clean_names() %>% 
  pivot_longer(
    jan:dec,
    names_to = "month",
    values_to = "percent"
  )

print(sapply(unemployment_df, class))  
view(unemployment_df)



```

## left join the datasets
```{r}
data_join = left_join(pols_df, snp_df) %>% 
  left_join(., unemployment_df)

view(data_join)
```



# Problem 2 
## part1 - read, clean and create the new weight_tons variable in the Mr. Trash Wheel sheet
```{r}
trawh_df = 
  readxl::read_excel("data/202309 Trash Wheel Collection Data.xlsx", 
                     sheet = "Mr. Trash Wheel", range = "A2:N586") %>% 
  janitor::clean_names() %>% 
  drop_na(dumpster) %>% 
  mutate(homes_powered = weight_tons * 500) %>% 
  mutate(wheel_type = "mr_trashwheel") %>% 
  relocate(wheel_type)

view(trawh_df)
```

## part2 -  read, clean and create the new weight_tons variable in the Professor Trash Wheel sheet
```{r}
prof_trawh_df = 
  readxl::read_excel("data/202309 Trash Wheel Collection Data.xlsx", 
                     sheet = "Professor Trash Wheel", range = "A2:M109") %>%
  janitor::clean_names() %>%
  drop_na(dumpster) %>% 
  mutate(homes_powered = weight_tons * 500) %>% 
  mutate(wheel_type = "prof_trashwheel") %>% 
  relocate(wheel_type)

print(sapply(prof_trawh_df, class))
view(prof_trawh_df) 
```

## part3 -  read, clean and create the new weight_tons variable in the  Gwynndal sheet
```{r}
gwy_trawh_df = 
  readxl::read_excel("data/202309 Trash Wheel Collection Data.xlsx", 
                     sheet = "Gwynnda Trash Wheel", range = "A2:L159") %>%
  janitor::clean_names() %>%
  drop_na(dumpster) %>% 
  mutate(homes_powered = weight_tons * 500) %>% 
  mutate(wheel_type = "gwy_trashwheel") %>% 
  relocate(wheel_type) %>% 
  mutate(dumpster = 1:155)

view(gwy_trawh_df) 
```

## part 4 - combine the datasets
```{r}
trawh_df_char = lapply(trawh_df, as.character)
prof_trawh_df_char = lapply(prof_trawh_df, as.character)
gwy_trawh_df_char = lapply(gwy_trawh_df, as.character)

trawhl_comb = bind_rows(trawh_df_char, prof_trawh_df_char, gwy_trawh_df_char)

view(trawhl_comb) 
```
The final dataset trawhl_comb contains `r nrow(trawhl_comb)` observations and it 
contains `r ncol(trawhl_comb)` variables. It also tells use in one specific date, a type of trashwheel collect how many of each type of trash and the power used in each day. As for the Mr. Trashwheel, the data is collected between `r min(trawh_df$year)` and `r max(trawh_df$year)`. As for Professor Trash Wheel, the data is collected 
between `r min(prof_trawh_df$year)` and `r max(prof_trawh_df$year)`. As for Gwynnda, the data is collected between `r min(gwy_trawh_df$year)` and `r max(gwy_trawh_df$year)`. In the Professor Trash Wheel dataset, the total weight of trash collected by Professor Trash Wheel is `r sum(prof_trawh_df$weight_tons)` tons. 
In the Gwynndal, the total number of cigarette butts collected in July of 2021 is *`r filter(gwy_trawh_df, year == 2021, month == "July") %>% pull(cigarette_butts) %>% 
sum()`*.



# Problem 3 
## part1 - import and clean-up the baseline dataset, we import and skip the first row of the original dataset. And then clean the names of all variables in each dataset. Also recode the apoe4 and sex variable in mci_baseline.
```{r}
mci_demo = 
  read_csv("data_mci/MCI_baseline.csv", skip = 1) %>% 
  janitor::clean_names() %>% 
  mutate(sex = recode(sex, `0` = "female", `1` = "male"),
        apoe4 = recode(apoe4, `0` = "non-carrier", `1` = "carrier")) %>% 
  
  
  
view(mci_demo)

```


```{r}
mci_amy = 
  read_csv("data_mci/mci_amyloid.csv", skip = 1) %>% 
  janitor::clean_names() %>% 
  rename(id = study_id)

view(mci_amy)
```


## part2 - join the two datasets to see and remove the observations that are not qualified for further analysis
```{r}
ad_df = left_join(mci_demo, mci_amy, by = "id") %>% 
  drop_na(baseline)

view(ad_df)
```
